<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>The Archive and Packaging (arcp) URI scheme</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Requirements Language"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Scheme syntax"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Authority"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Path"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Scheme semantics"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Authority semantics"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Path semantics"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Resolution protocol"/>
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Resolving from a .well-known endpoint"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Encoding considerations"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Interoperability considerations"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations"/>
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations"/>
<link href="#rfc.references" rel="Chapter" title="9 References"/>
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Examples"/>
<link href="#rfc.appendix.A.1" rel="Chapter" title="A.1 Sharing using app names"/>
<link href="#rfc.appendix.A.2" rel="Chapter" title="A.2 Sandboxing"/>
<link href="#rfc.appendix.A.3" rel="Chapter" title="A.3 Origin-based"/>
<link href="#rfc.appendix.A.4" rel="Chapter" title="A.4 Hash-based"/>
<link href="#rfc.appendix.A.5" rel="Chapter" title="A.5 Archives that are not files"/>
<link href="#rfc.appendix.A.6" rel="Chapter" title="A.6 Linked Data containers which are not on the web"/>
<link href="#rfc.appendix.A.7" rel="Chapter" title="A.7 Resolution of packaged resources"/>
<link href="#rfc.appendix.B" rel="Chapter" title="B Acknowledgements"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Soiland-Reyes, S. and M. C&#225;ceres" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-soilandreyes-arcp-01-SNAPSHOT" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-1-24" />
  <meta name="dct.abstract" content="This specification proposes the Application and Packaging URI scheme " />
  <meta name="description" content="This specification proposes the Application and Packaging URI scheme " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">S. Soiland-Reyes</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">The University of Manchester</td>
</tr>
<tr>
  <td class="left">Intended status: Informational</td>
  <td class="right">M. C&#225;ceres</td>
</tr>
<tr>
  <td class="left">Expires: July 28, 2018</td>
  <td class="right">Mozilla Corporation</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">January 24, 2018</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">The Archive and Packaging (arcp) URI scheme<br />
  <span class="filename">draft-soilandreyes-arcp-01-SNAPSHOT</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This specification proposes the Application and Packaging URI scheme <samp>arcp</samp>.</p>
<p>arcp URIs can be used to consume or reference hypermedia resources bundled inside a file archive or an application package, as well as to resolve URIs for archive resources within a programmatic framework.</p>
<p>This URI scheme provides mechanisms to generate a unique base URI to represent the root of the archive, so that relative URI references in a bundled resource can be resolved within the archive without having to extract the archive content on the local file system.</p>
<p>An arcp URI can be used for purposes of isolation (e.g. when consuming multiple archives), security constraints (avoiding &#8220;climb out&#8221; from the archive), or for externally identiyfing sub-resources referenced by hypermedia formats.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on July 28, 2018.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">Requirements Language</a></li>
<li>3.   <a href="#rfc.section.3">Scheme syntax</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Authority</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Path</a></li>
</ul><li>4.   <a href="#rfc.section.4">Scheme semantics</a></li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Authority semantics</a></li>
<li>4.2.   <a href="#rfc.section.4.2">Path semantics</a></li>
<li>4.3.   <a href="#rfc.section.4.3">Resolution protocol</a></li>
<li>4.4.   <a href="#rfc.section.4.4">Resolving from a .well-known endpoint</a></li>
</ul><li>5.   <a href="#rfc.section.5">Encoding considerations</a></li>
<li>6.   <a href="#rfc.section.6">Interoperability considerations</a></li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a></li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a></li>
<li>9.   <a href="#rfc.references">References</a></li>
<ul><li>9.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Examples</a></li>
<ul><li>A.1.   <a href="#rfc.appendix.A.1">Sharing using app names</a></li>
<li>A.2.   <a href="#rfc.appendix.A.2">Sandboxing</a></li>
<li>A.3.   <a href="#rfc.appendix.A.3">Origin-based</a></li>
<li>A.4.   <a href="#rfc.appendix.A.4">Hash-based</a></li>
<li>A.5.   <a href="#rfc.appendix.A.5">Archives that are not files</a></li>
<li>A.6.   <a href="#rfc.appendix.A.6">Linked Data containers which are not on the web</a></li>
<li>A.7.   <a href="#rfc.appendix.A.7">Resolution of packaged resources</a></li>
</ul><li>Appendix B.   <a href="#rfc.appendix.B">Acknowledgements</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">Mobile and Web Applications may bundle resources such as stylesheets with relative URI references to scripts, images and fonts. Resolving and parsing such resources within URI handling frameworks may require generating absolute URIs and applying Same-Origin <a href="#RFC6454">[RFC6454]</a> security policies separately for each app.</p>
<p id="rfc.section.1.p.2">Software that is accessing resources bundled inside an archive (e.g. <samp>zip</samp> or <samp>tar.gz</samp> file) can struggle to consume hypermedia content types that use relative URI references <a href="#RFC3986">[RFC3986]</a> such as <samp>../css/</samp>, as it is challenging to determine the base URI in a consistent fashion.</p>
<p id="rfc.section.1.p.3">Frequently the archive might be unpacked locally, implying base URIs like <samp>file:///tmp/a1b27ae03865/</samp> to represent the root of the archive. Such URIs are temporary, might not be globally unique, and could be vulnerable to attacks such as &#8220;climbing out&#8221; of the root directory.</p>
<p id="rfc.section.1.p.4">An archive containing multiple HTML or Linked Data resources, such as in a BagIt archive <a href="#I-D.draft-kunze-bagit-14">[I-D.draft-kunze-bagit-14]</a>, may be using relative URIs to cross-reference constituent files, making it challenging to index or annotate such resources.</p>
<p id="rfc.section.1.p.5">Consumptions of archives might be performed in memory or through a common framework, abstracting away any local file location.</p>
<p id="rfc.section.1.p.6">Consumption of an archive with a consistent base URL should be possible no matter from which location it was retrieved, or on which device it is inspected.</p>
<p id="rfc.section.1.p.7">When consuming multiple archives from untrusted sources it would be beneficial to have a Same Origin policy <a href="#RFC6454">[RFC6454]</a> so that relative hyperlinks can&#8217;t escape the particular archive.</p>
<p id="rfc.section.1.p.8">The <samp>file:</samp> URI scheme <a href="#RFC8089">[RFC8089]</a> can be ill-suited for purposes such as above, where a location-independent URI scheme is more flexible, secure and globally unique.</p>
<p id="rfc.section.1.p.9">This specification proposes the Archive and Packaging URI scheme <samp>arcp</samp> as an alternative to addressing resources within an archive, application or package.</p>
<p id="rfc.section.1.p.10">For the purpose of this specification, an <strong>archive</strong> is a collection of sub-resources addressable by name or path.  This definition covers typical archive file formats like <samp>.zip</samp> or <samp>tar.gz</samp> and derived <samp>+zip</samp> media types <a href="#RFC6839">[RFC6839]</a>, but also non-file resource packages like an LDP Container <a href="#W3C.REC-ldp-20150226">[W3C.REC-ldp-20150226]</a>, an installed Web App <a href="#W3C.WD-appmanifest-20180118">[W3C.WD-appmanifest-20180118]</a>, or a BagIt folder structure <a href="#I-D.draft-kunze-bagit-14">[I-D.draft-kunze-bagit-14]</a>.</p>
<p id="rfc.section.1.p.11">For brevity, the term <em>archive</em> is used throughout this specification, although from the above it can also mean a <em>container</em>, <em>application</em> or <em>package</em>.</p>
<p id="rfc.section.1.p.12">The main purpose of arcp URis to provide consistent identifiers as absolute URIs for nested resources. This specification does not define a new network protocol, however we suggest an abstract resolution protocol that implementations can apply using existing protocols or programming frameworks.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#requirements" id="requirements">Requirements Language</a></h1>
<p id="rfc.section.2.p.1">The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;,  &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#syntax" id="syntax">Scheme syntax</a></h1>
<p id="rfc.section.3.p.1">The <samp>arcp</samp> URI scheme follows the <a href="#RFC3986">[RFC3986]</a> syntax for hierarchical URIs according to the following productions:</p>
<pre>
URI           = scheme ":" arcp-specific [ "#" fragment ]

scheme        = "arcp"

arcp-specific  = "//" arcp-authority [ path-absolute ] [ "?" query ]
</pre>
<p id="rfc.section.3.p.2">The <samp>arcp-authority</samp> component provides a unique identifier for the opened archive. See <a href="#authority">Section 3.1</a> for details.</p>
<p id="rfc.section.3.p.3">The <samp>path-absolute</samp> component provides the absolute path of a resource (e.g. a file or directory) within the archive. See <a href="#path">Section 3.2</a> for details.</p>
<p id="rfc.section.3.p.4">The <samp>query</samp> component MAY be used, but its semantics is undefined by this specification.</p>
<p id="rfc.section.3.p.5">The &#8220;fragment&#8221; component MAY be used by implementations according to <a href="#RFC3986">[RFC3986]</a> and the implied media type <a href="#RFC2046">[RFC2046]</a> of the resource at the path. This specification does not specify how to determine the media type.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#authority" id="authority">Authority</a></h1>
<p id="rfc.section.3.1.p.1">The purpose of the <samp>authority</samp> component in an arcp URI is to build a unique base URI for a particular archive. The authority is NOT intended to be resolvable without former knowledge of the archive.</p>
<p id="rfc.section.3.1.p.2">The authority of an arcp URI MUST be valid according to these productions:</p>
<pre>
arcp-authority = uuid | ni | name | authority
uuid          = "uuid," UUID
ni            = "ni," alg-val
name          = "name," reg-name
</pre>
<p/>

<ol>
  <li>The prefix <samp>uuid,</samp> combines with the <samp>UUID</samp> production as defined in <a href="#RFC4122">[RFC4122]</a>, e.g.  <samp>uuid,2a47c495-ac70-4ed1-850b-8800a57618cf</samp></li>
  <li>The prefix <samp>ni,</samp> combines with the <samp>alg-val</samp> production as defined in <a href="#RFC6920">[RFC6920]</a>, e.g.  <samp>ni,sha-256;JCS7yveugE3UaZiHCs1XpRVfSHaewxAKka0o5q2osg8</samp></li>
  <li>The prefix <samp>name,</samp> combines with the <samp>reg-name</samp> production as defined in <a href="#RFC3986">[RFC3986]</a>, e.g. <samp>name,app.example.com</samp>.</li>
  <li>The production <samp>authority</samp> matches its definition in <a href="#RFC3986">[RFC3986]</a>.  As this necessarily also match the above prefixed productions, those should be considered first before falling back to this production.</li>
</ol>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#path" id="path">Path</a></h1>
<p id="rfc.section.3.2.p.1">The <samp>path-absolute</samp> component, if present, MUST match the production in <a href="#RFC3986">[RFC3986]</a> and provide the absolute path of a resource (e.g. a file or directory) within the archive.</p>
<p id="rfc.section.3.2.p.2">Archive media types vary in constraints and possibilities on how to express paths, however implementations SHOULD use <samp>/</samp> as path separator for nested folders and files.</p>
<p id="rfc.section.3.2.p.3">It is RECOMMENDED to include the trailing <samp>/</samp> if it is known the path represents a directory.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#semantics" id="semantics">Scheme semantics</a></h1>
<p id="rfc.section.4.p.1">This specification does not constrain what format might constitute an <em>archive</em>, and neither does it require that the archive is retrievable as a single bytestream or file.</p>
<p id="rfc.section.4.p.2">Examples of retrievable archive media types include <samp>application/zip</samp>, <samp>application/vnd.android.package-archive</samp>, <samp>application/x-tar</samp>, <samp>application/x-gtar</samp> and <samp>application/x-7z-compressed</samp>.</p>
<p id="rfc.section.4.p.3">Examples of non-file archives include an LDP Container <a href="#W3C.REC-ldp-20150226">[W3C.REC-ldp-20150226]</a>, an installed Web App <a href="#W3C.WD-appmanifest-20180118">[W3C.WD-appmanifest-20180118]</a>, or a BagIt folder structure <a href="#I-D.draft-kunze-bagit-14">[I-D.draft-kunze-bagit-14]</a>.</p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> <a href="#authority-semantics" id="authority-semantics">Authority semantics</a></h1>
<p id="rfc.section.4.1.p.1">The <em>authority</em> component identifies the archive itself.</p>
<p id="rfc.section.4.1.p.2">Implementations MAY assume that two arcp URIs with the same authority component relate to resources within the same archive, subject to limitations explained in this section.</p>
<p id="rfc.section.4.1.p.3">The authority prefix, if present, helps to inform consumers what uniqueness constraints have been used when identifying the archive, without necessarily providing access to the archive.</p>
<p/>

<ol>
  <li>If the prefix is <samp>uuid,</samp> followed by a UUID <a href="#RFC4122">[RFC4122]</a>, this indicates a unique archive identity.</li>
  <li>If the prefix is <samp>uuid,</samp> followed by a v4 UUID <a href="#RFC4122">[RFC4122]</a>, this indicate uniqueness based on a random number generator.<br/> Implementations creating random-based authorities SHOULD generate the v4 random UUID using a suitable random number generator <a href="#RFC4086">[RFC4086]</a>.</li>
  <li>If the prefix is <samp>uuid,</samp> followed by a v5 name-based UUID <a href="#RFC4122">[RFC4122]</a>, this indicates uniqueness based on an existing archive location, typically an URL.<br/> Implementations creating location-based authorities from an archive&#8217;s URL SHOULD generate the v5 UUID using the URL namespace <samp>6ba7b811-9dad-11d1-80b4-00c04fd430c8</samp> and the particular URL (see <a href="#RFC4122">[RFC4122]</a> section 4.3).<br/> Note that while implementations cannot resolve which location was used, they can confirm the name-based UUID if the location is otherwise known.</li>
  <li>If the prefix is <samp>ni,</samp> this indicates a unique archive identity based on a hashing of the archive&#8217;s bytestream or content.  Implementations can assume that resources within an <samp>ni</samp> arcp URIs remains static, although the implementation may use content negotiation or similar transformations.<br/> The checksum MUST be expressed according to <a href="#RFC6920">[RFC6920]</a>&#8217;s <samp>alg-val</samp> production.<br/> Implementations creating hash-based authorities from an archive&#8217;s bytestream SHOULD use the <samp>sha-256</samp> without truncation.</li>
  <li>If the prefix is <samp>name,</samp> this indicates that the authority is an application or package name, typically as installed on a device or system.<br/> Implementations SHOULD assume that an unrecognized <samp>name</samp> authority is only unique within a particular installation, but MAY assume further uniqueness guarantees for names under their control.<br/> It is RECOMMENDED that implementations creating name-based authorities use DNS names under their control, for instance an app installed as <samp>app.example.com</samp> can make an authority <samp>name,app.example.com</samp> to refer to its packaged resources, or <samp>name,foo.app.example.com</samp> to refer to a <samp>foo</samp> container distributed across all installations.</li>
</ol>
<p id="rfc.section.4.1.p.5">The uniqueness properties are unspecified for arcp URIs which authority do not match any of the prefixes defined in this specification.</p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> <a href="#path-semantics" id="path-semantics">Path semantics</a></h1>
<p id="rfc.section.4.2.p.1">The <em>path</em> component of an arcp URI identify individual resources within a particular archive, typically a <em>directory</em> or <em>file</em>.</p>
<p/>

<ul>
  <li>If the <em>path</em> is <samp>/</samp> - e.g. &lt;arcp://uuid,833ebda2-f9a8-4462-b74a-4fcdc1a02d22/&gt; - then the arcp URI represent the archive itself, typically represented as a root directory or collection.</li>
  <li>If the path ends with <samp>/</samp> then the path represents a directory or collection.</li>
</ul>
<p id="rfc.section.4.2.p.3">The arcp URIs can be used for uniquely identifying the resources independent of the location of the archive, such as within an information system.</p>
<p id="rfc.section.4.2.p.4">Assuming an appropriate resolution mechanism which have knowledge of the corresponding archive, an arcp URI can also be used for resolution.</p>
<p id="rfc.section.4.2.p.5">Some archive formats might permit resources with the same (duplicate) path, in which case it is undefined from this specification which particular entry is described.</p>
<h1 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> <a href="#resolution" id="resolution">Resolution protocol</a></h1>
<p id="rfc.section.4.3.p.1">This specification do not define the protocol to resolve resources according to the arcp URI scheme.  For instance, one implementation might rewrite arcp URIs to localized paths in a temporary directory, while another implementation might use an embedded HTTP server.</p>
<p id="rfc.section.4.3.p.2">It is envisioned that an implementation will have extracted or opened an archive in advance, and assigned it an appropriate authority according to <a href="#authority">Section 3.1</a>. Such an implementation can then resolve arcp URIs programmatically, e.g. by using in-memory access or mapping paths to the extracted archive on the local file system.</p>
<p id="rfc.section.4.3.p.3">Implementations that support resolving arcp URIs SHOULD:</p>
<p/>

<ol>
  <li>Fail with the equivalent of <em>Not Found</em> if the authority is unknown.</li>
  <li>Fail with the equivalent of <em>Gone</em> if the authority is known, but the content of the archive is no longer available.</li>
  <li>Fail with the equivalent of <em>Not Found</em> if the path does not map to a file or directory within the archive.</li>
  <li>Return the corresponding (potentially uncompressed) bytestream if the path maps to a file within the archive.</li>
  <li>Return an appropriate directory listing if the path maps to a directory within the archive.</li>
  <li>Return an appropriate directory listing of the archive&#8217;s root directory if the path is <samp>/</samp>.</li>
</ol>
<p id="rfc.section.4.3.p.5">Not all archive formats or implementations will have the concept of a directory listing, in which case the implementation MAY fail such resolutions with the equivalent of &#8220;Not Implemented&#8221;.</p>
<p id="rfc.section.4.3.p.6">It is not undefined by this specification how an implementation can determine the media type of a file within an archive. This could be expressed in secondary resources (such as a manifest), be determined by file extensions or magic bytes.</p>
<p id="rfc.section.4.3.p.7">The media type <samp>text/uri-list</samp> <a href="#RFC2483">[RFC2483]</a> MAY be used to represent a directory listing, in which case it SHOULD contain only URIs that start with the arcp URI of the directory.</p>
<p id="rfc.section.4.3.p.8">Some archive formats might support resources which are neither directories nor regular files (e.g. device files, symbolic links). This specification does not define the semantics of attempting to resolve such resources.</p>
<p id="rfc.section.4.3.p.9">This specification does not define how to change an archive or its content using arcp URIs.</p>
<h1 id="rfc.section.4.4"><a href="#rfc.section.4.4">4.4.</a> <a href="#well-known" id="well-known">Resolving from a .well-known endpoint</a></h1>
<p id="rfc.section.4.4.p.1">If the <samp>authority</samp> component of an arcp URI matches the <samp>alg-val</samp> production, an application MAY attempt to resolve the authority from any <samp>.well-known/ni/</samp> endpoint <a href="#RFC5785">[RFC5785]</a> as specified in <a href="#RFC6920">[RFC6920]</a> section 4, in order to retrieve the complete archive. Applications SHOULD verify the checksum of the retrieved archive before resolving the individual path.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#encoding" id="encoding">Encoding considerations</a></h1>
<p id="rfc.section.5.p.1">The productions for <samp>UUID</samp> and <samp>alg-val</samp> are restricted to URI safe ASCII and should not require any encoding considerations.</p>
<p id="rfc.section.5.p.2">Care should be taken to %-encode the directory and file segments of <samp>path-absolute</samp> according to <a href="#RFC3986">[RFC3986]</a> (for URIs) or <a href="#RFC3987">[RFC3987]</a> (for IRIs).</p>
<p id="rfc.section.5.p.3">When used as part an IRI, paths SHOULD be expressed using international Unicode characters instead of %-encoding as ASCII.</p>
<p id="rfc.section.5.p.4">Not all archive formats have an explicit character encoding specified for their paths.  If no such information is available for the archive format, implementations MAY assume that the path component is encoded with UTF-8 <a href="#RFC2279">[RFC2279]</a>.</p>
<p id="rfc.section.5.p.5">Some archive formats have case-insensitive paths, in which cases it is RECOMMENDED to preserve the casing as expressed in the archive.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#interoperability" id="interoperability">Interoperability considerations</a></h1>
<p id="rfc.section.6.p.1">As multiple authorities are possible for the same archive (<a href="#authority">Section 3.1</a>), and path interpretation might vary, there can be interoperability challenges when exchanging arcp URIs between implementations. Some considerations:</p>
<p/>

<ol>
  <li>Two implementations describe the same archive (e.g. stored in the same local file path), but using different random-based UUID authorities. The implementations may need to detect equality of the two UUIDs out of band.</li>
  <li>Two implementations describe an archive retrieved from the same URL, with the same location-based UUID authority, but retrieved at different times. The implementations might disagree about the content of the archive.</li>
  <li>Two implementations describe an archive retrieved from the same URL, with the same location-based UUID authority, but retrieved using different content negotiation resulting in different archive representations. The implementations may disagree about path encoding, file name casing or hierarchy.</li>
  <li>Two implementations describe the same archive bytestream using the hash-based authority, but they have used two different hash algorithms. The implementations may need to negotiate to a common hash algorithm.</li>
  <li>Two implementations access the same archive, which contain file paths with Unicode characters, but extracted to two different file systems. Limitations and conventions for file names in the local file system (such as Unicode normalization, case insensitivity, total path length) may result in the implementations having inconsistent or inaccessible paths.</li>
</ol>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#security" id="security">Security Considerations</a></h1>
<p id="rfc.section.7.p.1">As when handling any content, extra care should be taken when consuming archives and arcp URIs from unknown sources.</p>
<p id="rfc.section.7.p.2">An archive could contain compressed files that expand to fill all available disk space.</p>
<p id="rfc.section.7.p.3">A maliciously crafted archive could contain paths with characters (e.g. backspace) which could make an arcp URI invalid or misleading if used unescaped.</p>
<p id="rfc.section.7.p.4">A maliciously crafted archive could contain paths (e.g. combined Unicode sequences) that cause the arcp URI to be very long, causing issues in information systems propagating said URI.</p>
<p id="rfc.section.7.p.5">An archive might contain symbolic links that, if extracted to a local file system, might address files outside the archive&#8217;s directory structure. Implementations SHOULD detect such links and prevent outside access.</p>
<p id="rfc.section.7.p.6">An maliciously crafted arcp URI might contain <samp>../</samp> path segments, which if naively converted to a <samp>file:///</samp> URI might address files outside the archive&#8217;s directory structure. Implementations SHOULD perform Path Segment Normalization <a href="#RFC3986">[RFC3986]</a> before converting arcp URIs.</p>
<p id="rfc.section.7.p.7">In particular for IRIs, an archive might contain multiple paths with similar-looking characters or with different Unicode combine sequences, which could be used to mislead users.</p>
<p id="rfc.section.7.p.8">An URI hyperlink might use or guess an arcp URI authority to attempt to climb into a different archive for malicious purposes. Applications SHOULD employ Same Orgin policy <a href="#RFC6454">[RFC6454]</a> checks if resolving cross-references is not desired.</p>
<p id="rfc.section.7.p.9">While a UUID or hash-based authority provide some level of information hiding of an archive&#8217;s origin, this should not be relied upon for access control or anonymisation. Implementors should keep in mind that such authority components in many cases can be predictably generated by third-parties, for instance using dictionary attacks.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#iana" id="iana">IANA Considerations</a></h1>
<p id="rfc.section.8.p.1">This specification requests that IANA registers the following URI scheme according to the provisions of <a href="#RFC7595">[RFC7595]</a>.</p>
<p id="rfc.section.8.p.2">Scheme name: arcp</p>
<p id="rfc.section.8.p.3">Status: provisional</p>
<p id="rfc.section.8.p.4">Applications/protocols that use this protocol: Hypermedia-consuming application that handle archives or packages.</p>
<p id="rfc.section.8.p.5">Contact: Stian Soiland-Reyes <a href="mailto:stain@apache.org">stain@apache.org</a></p>
<p id="rfc.section.8.p.6">Change controller: Stian Soiland-Reyes</p>
<h1 id="rfc.references"><a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2279">[RFC2279]</b>
      </td>
      <td class="top"><a>Yergeau, F.</a>, "<a href="http://tools.ietf.org/html/rfc2279">UTF-8, a transformation format of ISO 10646</a>", RFC 2279, DOI 10.17487/RFC2279, January 1998.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2483">[RFC2483]</b>
      </td>
      <td class="top"><a>Mealling, M.</a> and <a>R. Daniel</a>, "<a href="http://tools.ietf.org/html/rfc2483">URI Resolution Services Necessary for URN Resolution</a>", RFC 2483, DOI 10.17487/RFC2483, January 1999.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3986">[RFC3986]</b>
      </td>
      <td class="top"><a>Berners-Lee, T.</a>, <a>Fielding, R.</a> and <a>L. Masinter</a>, "<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, DOI 10.17487/RFC3986, January 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3987">[RFC3987]</b>
      </td>
      <td class="top"><a>Duerst, M.</a> and <a>M. Suignard</a>, "<a href="http://tools.ietf.org/html/rfc3987">Internationalized Resource Identifiers (IRIs)</a>", RFC 3987, DOI 10.17487/RFC3987, January 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4086">[RFC4086]</b>
      </td>
      <td class="top"><a>Eastlake 3rd, D.</a>, <a>Schiller, J.</a> and <a>S. Crocker</a>, "<a href="http://tools.ietf.org/html/rfc4086">Randomness Requirements for Security</a>", BCP 106, RFC 4086, DOI 10.17487/RFC4086, June 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4122">[RFC4122]</b>
      </td>
      <td class="top"><a>Leach, P.</a>, <a>Mealling, M.</a> and <a>R. Salz</a>, "<a href="http://tools.ietf.org/html/rfc4122">A Universally Unique IDentifier (UUID) URN Namespace</a>", RFC 4122, DOI 10.17487/RFC4122, July 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5785">[RFC5785]</b>
      </td>
      <td class="top"><a>Nottingham, M.</a> and <a>E. Hammer-Lahav</a>, "<a href="http://tools.ietf.org/html/rfc5785">Defining Well-Known Uniform Resource Identifiers (URIs)</a>", RFC 5785, DOI 10.17487/RFC5785, April 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6454">[RFC6454]</b>
      </td>
      <td class="top"><a>Barth, A.</a>, "<a href="http://tools.ietf.org/html/rfc6454">The Web Origin Concept</a>", RFC 6454, DOI 10.17487/RFC6454, December 2011.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6920">[RFC6920]</b>
      </td>
      <td class="top"><a>Farrell, S.</a>, <a>Kutscher, D.</a>, <a>Dannewitz, C.</a>, <a>Ohlman, B.</a>, <a>Keranen, A.</a> and <a>P. Hallam-Baker</a>, "<a href="http://tools.ietf.org/html/rfc6920">Naming Things with Hashes</a>", RFC 6920, DOI 10.17487/RFC6920, April 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7595">[RFC7595]</b>
      </td>
      <td class="top"><a>Thaler, D.</a>, <a>Hansen, T.</a> and <a>T. Hardie</a>, "<a href="http://tools.ietf.org/html/rfc7595">Guidelines and Registration Procedures for URI Schemes</a>", BCP 35, RFC 7595, DOI 10.17487/RFC7595, June 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="FirefoxOS">[FirefoxOS]</b>
      </td>
      <td class="top"><a>Mozilla Firefox</a>, "<a href="https://developer.mozilla.org/en-US/docs/Archive/B2G_OS/Security/Security_model#Packaged_Apps">Firefox OS security overview</a>", MDN Mozilla Developer Network Web Docs, February 2017.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.draft-kunze-bagit-14">[I-D.draft-kunze-bagit-14]</b>
      </td>
      <td class="top"><a>Kunze, J.</a>, <a>Littman, J.</a>, <a>Madden, L.</a>, <a>Summers, E.</a>, <a>Boyko, A.</a> and <a>B. Vargas</a>, "<a href="http://tools.ietf.org/html/draft-kunze-bagit-14">The BagIt File Packaging Format (V0.97)</a>", Internet-Draft draft-kunze-bagit-14, October 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2046">[RFC2046]</b>
      </td>
      <td class="top"><a>Freed, N.</a> and <a>N. Borenstein</a>, "<a href="http://tools.ietf.org/html/rfc2046">Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</a>", RFC 2046, DOI 10.17487/RFC2046, November 1996.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4648">[RFC4648]</b>
      </td>
      <td class="top"><a>Josefsson, S.</a>, "<a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>", RFC 4648, DOI 10.17487/RFC4648, October 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6570">[RFC6570]</b>
      </td>
      <td class="top"><a>Gregorio, J.</a>, <a>Fielding, R.</a>, <a>Hadley, M.</a>, <a>Nottingham, M.</a> and <a>D. Orchard</a>, "<a href="http://tools.ietf.org/html/rfc6570">URI Template</a>", RFC 6570, DOI 10.17487/RFC6570, March 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6839">[RFC6839]</b>
      </td>
      <td class="top"><a>Hansen, T.</a> and <a>A. Melnikov</a>, "<a href="http://tools.ietf.org/html/rfc6839">Additional Media Type Structured Syntax Suffixes</a>", RFC 6839, DOI 10.17487/RFC6839, January 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC8089">[RFC8089]</b>
      </td>
      <td class="top"><a>Kerwin, M.</a>, "<a href="http://tools.ietf.org/html/rfc8089">The "file" URI Scheme</a>", RFC 8089, DOI 10.17487/RFC8089, February 2017.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="ROBundle">[ROBundle]</b>
      </td>
      <td class="top"><a>Soiland-Reyes, S.</a>, <a>Gamble, M.</a> and <a>R. Haines</a>, "<a href="https://w3id.org/bundle/">Research Object Bundle 1.0</a>", Zenodo report, DOI 10.5281/zenodo.12586, November 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="W3C.NOTE-app-uri-20150723">[W3C.NOTE-app-uri-20150723]</b>
      </td>
      <td class="top"><a>Caceres, M.</a>, "<a href="http://www.w3.org/TR/2015/NOTE-app-uri-20150723">The app: URL Scheme</a>", World Wide Web Consortium NOTE NOTE-app-uri-20150723, July 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="W3C.NOTE-widgets-uri-20120313">[W3C.NOTE-widgets-uri-20120313]</b>
      </td>
      <td class="top"><a>Caceres, M.</a>, "<a href="http://www.w3.org/TR/2012/NOTE-widgets-uri-20120313">Widget URI scheme</a>", World Wide Web Consortium NOTE NOTE-widgets-uri-20120313, March 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="W3C.REC-ldp-20150226">[W3C.REC-ldp-20150226]</b>
      </td>
      <td class="top"><a>Speicher, S.</a>, <a>Arwe, J.</a> and <a>A. Malhotra</a>, "<a href="http://www.w3.org/TR/2015/REC-ldp-20150226">Linked Data Platform 1.0</a>", World Wide Web Consortium Recommendation REC-ldp-20150226, February 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="W3C.WD-appmanifest-20180118">[W3C.WD-appmanifest-20180118]</b>
      </td>
      <td class="top"><a>Caceres, M.</a>, <a>Christiansen, K.</a>, <a>Lamouri, M.</a>, <a>Kostiainen, A.</a> and <a>R. Dolin</a>, "<a href="https://www.w3.org/TR/2018/WD-appmanifest-20180118">Web App Manifest</a>", World Wide Web Consortium WD WD-appmanifest-20180118, January 2018.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#examples" id="examples">Examples</a></h1>
<h1 id="rfc.appendix.A.1"><a href="#rfc.appendix.A.1">A.1.</a> <a href="#sharing-using-app-names" id="sharing-using-app-names">Sharing using app names</a></h1>
<p id="rfc.section.A.1.p.1">A photo gallery application on a mobile device uses arcp URIs for navigation between its UI states.  The gallery is secured so that other applications can&#8217;t normally access its photos.</p>
<p id="rfc.section.A.1.p.2">The application is installed as the app name <samp>gallery.example.org</samp> as the vendor controls <samp>example.org</samp>, making the corresponding name-based arcp URI:</p>
<pre>
arcp://name,gallery.example.org/
</pre>
<p id="rfc.section.A.1.p.3">A user is at the application state which shows the newest photos as thumbnails:</p>
<pre>
arcp://name,gallery.example.org/photos/?New
</pre>
<p id="rfc.section.A.1.p.4">The user selects a photo, rendered with metadata overlaid:</p>
<pre>
arcp://name,gallery.example.org/photos/137
</pre>
<p id="rfc.section.A.1.p.5">The user requests to &#8220;share&#8221; the photo, selecting <samp>messaging.example.com</samp> which uses a common arcp URI framework on the device.</p>
<p id="rfc.section.A.1.p.6">The photo gallery registers with the device&#8217;s arcp framework that the chosen <samp>messaging.example.com</samp> gets read permission to its <samp>/photos/137</samp> resource.</p>
<p id="rfc.section.A.1.p.7">The sharing function returns a URI Template <a href="#RFC6570">[RFC6570]</a>:</p>
<pre>
arcp://name,messaging.example.com/share{;uri}{;redirect}
</pre>
<p id="rfc.section.A.1.p.8">Filling in the template, the gallery requests to pop up:</p>
<pre>
arcp://name,messaging.example.com/share
  ;uri=arcp://gallery.example.org/photos/137
  ;redirect=arcp://gallery.example.org/photos/%3fNew
</pre>
<p id="rfc.section.A.1.p.9">The arcp framework checks its registration for <samp>messaging.example.com</samp> and finds the installed messaging application. It performs permission checks that other apps are allowed to navigate to its <samp>/share</samp> state.</p>
<p id="rfc.section.A.1.p.10">The messaging app is launched and navigates to its &#8220;sharing&#8221; UI, asking the user for a caption.</p>
<p id="rfc.section.A.1.p.11">The messaging app requests the arcp framework to retrieve &lt;arcp://name,gallery.example.org/photos/137&gt; using content negotiation for an <samp>image/jpeg</samp> representation.</p>
<p id="rfc.section.A.1.p.12">The arcp framework finds the installed photo gallery <samp>gallery.example.org</samp>, and confirms the read permission.</p>
<p id="rfc.section.A.1.p.13">The photo gallery application returns a JPEG representation after retrieving the photo from its internal store.</p>
<p id="rfc.section.A.1.p.14">After the messaging app has completed sharing the picture bytestream, it request the UI framework to navigate to:</p>
<pre>
arcp://name,gallery.example.org/photos/?New
</pre>
<p id="rfc.section.A.1.p.15">The UI returns to the original view in the photo gallery.</p>
<p id="rfc.section.A.1.p.16">If the messaging app had attempted to <em>retrieve</em> the arcp URI</p>
<pre>
arcp://name,gallery.example.org/photos/?New
</pre>
<p id="rfc.section.A.1.p.17">then it would be rejected by the arcp framework as permission was not granted.</p>
<p id="rfc.section.A.1.p.18">However, if such access had been granted, the gallery could return a <samp>text/uri-list</samp> of the newest photos:</p>
<pre>
arcp://name,gallery.example.org/photos/137
arcp://name,gallery.example.org/photos/138
arcp://name,gallery.example.org/photos/139
</pre>
<p id="rfc.section.A.1.p.19">This examples show that although an arcp URI represents a resource, it can have different representations or UI states for different apps.</p>
<h1 id="rfc.appendix.A.2"><a href="#rfc.appendix.A.2">A.2.</a> <a href="#sandboxing" id="sandboxing">Sandboxing</a></h1>
<p id="rfc.section.A.2.p.1">An document store application has received a file <samp>document.tar.gz</samp> which content will be checked for consistency.</p>
<p id="rfc.section.A.2.p.2">For sandboxing purposes it generates a UUID v4 <samp>32a423d6-52ab-47e3-a9cd-54f418a48571</samp> using a pseudo-random generator.  The arcp base URI is thus:</p>
<pre>
arcp://uuid,32a423d6-52ab-47e3-a9cd-54f418a48571/
</pre>
<p id="rfc.section.A.2.p.3">The archive contains the files:</p>
<p/>

<ul>
  <li><samp>./doc.html</samp>  which links to <samp>css/base.css</samp></li>
  <li><samp>./css/base.css</samp>  which links to <samp>../fonts/Coolie.woff</samp></li>
  <li>
    <samp>./fonts/Coolie.woff</samp>
  </li>
</ul>
<p id="rfc.section.A.2.p.5">The application generates the corresponding arcp URIs and uses those for URI resolutions to list resources and their hyperlinks:</p>
<pre>
arcp://uuid,32a423d6-52ab-47e3-a9cd-54f418a48571/doc.html
  -&gt; arcp://uuid,32a423d6-52ab-47e3-a9cd-54f418a48571/css/base.css
arcp://uuid,32a423d6-52ab-47e3-a9cd-54f418a48571/css/base.css
  -&gt; arcp://uuid,32a423d6-52ab-47e3-a9cd-54f418a48571/fonts/Coolie.woff
arcp://uuid,32a423d6-52ab-47e3-a9cd-54f418a48571/fonts/Coolie.woff
</pre>
<p id="rfc.section.A.2.p.6">The application is now confident that all hyperlinked files are indeed present in the archive. In its database it notes which <samp>tar.gz</samp> file corresponds to UUID <samp>32a423d6-52ab-47e3-a9cd-54f418a48571</samp>.</p>
<p id="rfc.section.A.2.p.7">If the application had encountered a malicious hyperlink <samp>../../../outside.txt</samp> it would first resolve it to the absolute URI &lt;arcp://uuid,32a423d6-52ab-47e3-a9cd-54f418a48571/outside.txt&gt; and conclude from the &#8220;Not Found&#8221; error that the path <samp>/outside.txt</samp> was not present in the archive.</p>
<h1 id="rfc.appendix.A.3"><a href="#rfc.appendix.A.3">A.3.</a> <a href="#origin-based" id="origin-based">Origin-based</a></h1>
<p id="rfc.section.A.3.p.1">A web crawler is about to index the content of the URL <a href="http://example.com/data.zip">http://example.com/data.zip</a> and need to generate absolute URIs as it continues crawling inside the individual resources of the archive.</p>
<p id="rfc.section.A.3.p.2">The application generates a UUID v5 based on the URL namespace <samp>6ba7b811-9dad-11d1-80b4-00c04fd430c8</samp> and the URL to the zip file:</p>
<pre>
&gt;&gt;&gt; uuid.uuid5(uuid.NAMESPACE_URL, "http://example.com/data.zip")
UUID('b7749d0b-0e47-5fc4-999d-f154abe68065')
</pre>
<p id="rfc.section.A.3.p.3">Thus the location-based arcp URI for indexing the ZIP content is</p>
<pre>
arcp://uuid,b7749d0b-0e47-5fc4-999d-f154abe68065/
</pre>
<p id="rfc.section.A.3.p.4">Listing all directories and files in the ZIP, the crawler finds the URIs:</p>
<pre>
arcp://uuid,b7749d0b-0e47-5fc4-999d-f154abe68065/
arcp://uuid,b7749d0b-0e47-5fc4-999d-f154abe68065/pics/
arcp://uuid,b7749d0b-0e47-5fc4-999d-f154abe68065/pics/flower.jpeg
</pre>
<p id="rfc.section.A.3.p.5">When the application encounters <a href="http://example.com/data.zip">http://example.com/data.zip</a> some time later it can recalculate the same base arcp URI. This time the ZIP file has been modified upstream and the crawler finds additionally:</p>
<pre>
arcp://uuid,b7749d0b-0e47-5fc4-999d-f154abe68065/pics/cloud.jpeg
</pre>
<p id="rfc.section.A.3.p.6">If files had been removed from the updated ZIP file the crawler can simply remove those from its database, as it used the same arcp base URI as in last crawl.</p>
<h1 id="rfc.appendix.A.4"><a href="#rfc.appendix.A.4">A.4.</a> <a href="#hash-based" id="hash-based">Hash-based</a></h1>
<p id="rfc.section.A.4.p.1">An application where users can upload software distributions for virus checking needs to avoid duplication as users tend to upload <samp>foo-1.2.tar</samp> multiple times.</p>
<p id="rfc.section.A.4.p.2">The application calculates the <samp>sha-256</samp> checksum of the uploaded file to be in hexadecimal:</p>
<pre>
17edf80f84d478e7c6d2c7a5cfb4442910e8e1778f91ec0f79062d8cbdef42cd
</pre>
<p id="rfc.section.A.4.p.3">The <samp>base64url</samp> encoding <a href="#RFC4648">[RFC4648]</a> of the binary version of the checksum is:</p>
<pre>
F-34D4TUeOfG0selz7REKRDo4XePkewPeQYtjL3vQs0
</pre>
<p id="rfc.section.A.4.p.4">The corresponding <samp>alg-val</samp> authority is thus:</p>
<pre>
sha-256;F-34D4TUeOfG0selz7REKRDo4XePkewPeQYtjL3vQs0
</pre>
<p id="rfc.section.A.4.p.5">From this the hash base arcp URL is:</p>
<pre>
arcp://ni,sha-256;F-34D4TUeOfG0selz7REKRDo4XePkewPeQYtjL3vQs0/
</pre>
<p id="rfc.section.A.4.p.6">The crawler finds that its virus database already contain entries for:</p>
<pre>
arcp://ni,sha-256;F-34D4TUeOfG0selz7REKRDo4XePkewPeQYtjL3vQs0/bin/evil
</pre>
<p id="rfc.section.A.4.p.7">and flags the upload as malicious without having to scan it again.</p>
<h1 id="rfc.appendix.A.5"><a href="#rfc.appendix.A.5">A.5.</a> <a href="#archives-that-are-not-files" id="archives-that-are-not-files">Archives that are not files</a></h1>
<p id="rfc.section.A.5.p.1">An application is relating BagIt archives <a href="#I-D.draft-kunze-bagit-14">[I-D.draft-kunze-bagit-14]</a> on a shared file system, using structured folders and manifests rather than individual archive files.</p>
<p id="rfc.section.A.5.p.2">The BagIt payload manifest <samp>/gfs/bags/scan15/manifest-md5.txt</samp> lists the files:</p>
<pre>
49afbd86a1ca9f34b677a3f09655eae9 data/27613-h/q172.png
408ad21d50cef31da4df6d9ed81b01a7 data/27613-h/q172.txt
</pre>
<p id="rfc.section.A.5.p.3">The application generates a random UUID v4 <samp>ff2d5a82-7142-4d3f-b8cc-3e662d6de756</samp> which it adds to the bag metadata file <samp>/gfs/bags/scan15/bag-info.txt</samp></p>
<pre>
External-Identifier: ff2d5a82-7142-4d3f-b8cc-3e662d6de756
</pre>
<p id="rfc.section.A.5.p.4">It then generates arcp URIs for the files listed in the manifest:</p>
<pre>
arcp://uuid,ff2d5a82-7142-4d3f-b8cc-3e662d6de756/data/27613-h/q172.png
arcp://uuid,ff2d5a82-7142-4d3f-b8cc-3e662d6de756/data/27613-h/q172.txt
</pre>
<p id="rfc.section.A.5.p.5">When a different application on the same shared file system encounter these arcp URIs, it can match them to the correct bag folder by inspecting the <samp>External-Identifier</samp> metadata.</p>
<h1 id="rfc.appendix.A.6"><a href="#rfc.appendix.A.6">A.6.</a> <a href="#linked-data-containers-which-are-not-on-the-web" id="linked-data-containers-which-are-not-on-the-web">Linked Data containers which are not on the web</a></h1>
<p id="rfc.section.A.6.p.1">An application exposes in-memory objects of an Address Book as a Linked Data Platform container <a href="#W3C.REC-ldp-20150226">[W3C.REC-ldp-20150226]</a>, but addressing the container using arcp URIs instead of http to avoid network exposure.</p>
<p id="rfc.section.A.6.p.2">The arcp URIs are used in conjuction with a generic LDP client library (developed for http), but connected to the application&#8217;s URI resolution mechanism.</p>
<p id="rfc.section.A.6.p.3">The application generates a new random UUID v4 <samp>12f89f9c-e6ca-4032-ae73-46b68c2b415a</samp> for the address book, and provides the corresponding arcp URI to the LDP client:</p>
<pre>
arcp://uuid,12f89f9c-e6ca-4032-ae73-46b68c2b415a/
</pre>
<p id="rfc.section.A.6.p.4">The LDP client resolves the container with content negotiation for the <samp>text/turtle</samp> media type, and receives:</p>
<pre>
@base &lt;arcp://uuid,12f89f9c-e6ca-4032-ae73-46b68c2b415a/&gt;.
@prefix ldp: &lt;http://www.w3.org/ns/ldp#&gt;.
@prefix dcterms: &lt;http://purl.org/dc/terms/&gt;.

&lt;arcp://uuid,12f89f9c-e6ca-4032-ae73-46b68c2b415a/&gt;
  a ldp:BasicContainer;
  dcterms:title "Address book";
  ldp:contains &lt;contact1&gt;, &lt;contact2&gt;.
</pre>
<p id="rfc.section.A.6.p.5">The LDP client resolves the relative URIs to retrieve each of the contacts:</p>
<pre>
arcp://uuid,12f89f9c-e6ca-4032-ae73-46b68c2b415a/contact1
arcp://uuid,12f89f9c-e6ca-4032-ae73-46b68c2b415a/contact2
</pre>
<h1 id="rfc.appendix.A.7"><a href="#rfc.appendix.A.7">A.7.</a> <a href="#resolution-of-packaged-resources" id="resolution-of-packaged-resources">Resolution of packaged resources</a></h1>
<p id="rfc.section.A.7.p.1">A virtual file system driver on a mobile operating system has mounted several packaged applications for resolving common resources. An application requests the rendering framework to resolve a picture from &lt;arcp://uuid,eb1edec9-d2eb-4736-a875-eb97b37c690e/img/logo.png&gt; to show it within a user interface.</p>
<p id="rfc.section.A.7.p.2">The framework first checks that the authority <samp>uuid,eb1edec9-d2eb-4736-a875-eb97b37c690e</samp> is valid to access according to the Same Origin policies or permissions of the running application. It then matches the authority to the corresponding application package.</p>
<p id="rfc.section.A.7.p.3">The framework resolves <samp>/img/logo.png</samp> from within that package, and returns an image buffer it already had cached in memory.</p>
<h1 id="rfc.appendix.B"><a href="#rfc.appendix.B">Appendix B.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.B.p.1">This specification is inspired by two original URI scheme proposals from W3C, <samp>app</samp> from <a href="#W3C.NOTE-app-uri-20150723">[W3C.NOTE-app-uri-20150723]</a>  and <samp>widget</samp> from <a href="#W3C.NOTE-widgets-uri-20120313">[W3C.NOTE-widgets-uri-20120313]</a>.</p>
<p id="rfc.section.B.p.2">The <samp>app</samp> URI scheme was used by packaged web apps in Mozilla&#8217;s Firefox OS <a href="#FirefoxOS">[FirefoxOS]</a> and to identify resources in Research Object Bundles <a href="#ROBundle">[ROBundle]</a>, however the W3C Notes did not progress further as W3C Recommendation track documents, and their URI schemes were never formally registered with IANA.</p>
<p id="rfc.section.B.p.3">While the focus of the previous proposals was to specify how to resolve resources from within a packaged application, this specification generalize the URI scheme to support referencing and identifying resources within any archive, package or application, and adding flexibility for how resources can be resolved.</p>
<p id="rfc.section.B.p.4">The authors would like to thank Graham Klyne, Carsten Bormann, Roy T. Fielding, S Moonesamy and Julian Reschke for valuable feedback and suggestions.</p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Stian Soiland-Reyes</span> 
	  <span class="n hidden">
		<span class="family-name">Soiland-Reyes</span>
	  </span>
	</span>
	<span class="org vcardline">The University of Manchester</span>
	<span class="adr">
	  <span class="vcardline">Oxford Road</span>

	  <span class="vcardline">
		<span class="locality">Manchester</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">United Kingdom</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:stain@apache.org">stain@apache.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Marcos C&#225;ceres</span> 
	  <span class="n hidden">
		<span class="family-name">C&#225;ceres</span>
	  </span>
	</span>
	<span class="org vcardline">Mozilla Corporation</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:marcos@marcosc.com">marcos@marcosc.com</a></span>

  </address>
</div>

</body>
</html>
